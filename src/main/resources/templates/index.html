<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>헬스 추천 플랫폼</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f2f2f2; margin: 0; padding: 0; }
        header { background: #212121; color: white; padding: 20px; text-align: center; }
        nav { background: #333; display: flex; justify-content: center; gap: 30px; padding: 15px 0; position: relative; flex-wrap: wrap; }
        nav a { color: #fff; text-decoration: none; font-weight: bold; font-size: 18px; cursor: pointer; }
        .dropdown { position: relative; }
        .dropdown-content { display: none; position: absolute; top: 100%; left: 0; background-color: #444; border-radius: 5px; padding: 10px 0; z-index: 100; }
        .dropdown:hover .dropdown-content { display: block; }
        .dropdown-content a { display: block; padding: 10px 20px; color: white; text-decoration: none; white-space: nowrap; cursor: pointer; }
        .dropdown-content a:hover { background-color: #555; }
        .content { text-align: center; padding: 40px; }
        .content img { width: 400px; margin-top: 20px; display: block; margin-left: auto; margin-right: auto; }
        .nav-buttons { margin-top: 20px; }
        .nav-buttons button { padding: 12px 24px; font-size: 18px; margin: 0 10px; background-color: #4CAF50; color: white; border: none; border-radius: 8px; cursor: pointer; }
        .nav-buttons button:hover { background-color: #388e3c; }
        .goal-select { display: flex; justify-content: center; gap: 40px; margin: 40px auto; }
        .goal-select form button { padding: 20px 40px; font-size: 22px; border: none; border-radius: 12px; background-color: #4CAF50; color: white; cursor: pointer; }
        .goal-select form button:hover { background-color: #388e3c; }
        footer { background: #212121; color: white; text-align: center; padding: 20px; margin-top: 40px; }

        /* 수정된 챗봇 팝업 */
        .chatbot-popup {
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s ease;
            position: fixed;
            bottom: 80px;
            right: 40px;
            width: 300px;
            height: 400px;
            background: #fff;
            border: 2px solid #4CAF50;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            z-index: 999;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            resize: both;
            min-width: 250px;
            min-height: 300px;
        }
        .chatbot-header {
            background: #4CAF50;
            color: white;
            padding: 10px;
            font-weight: bold;
            text-align: center;
        }
        .chatbot-body {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            font-size: 14px;
            background-color: #f9f9f9;
        }
        .chatbot-footer {
            display: flex;
            flex-shrink: 0;
            border-top: 1px solid #ccc;
            padding: 5px;
            background-color: #fff;
        }
        .chatbot-footer input {
            flex: 1;
            padding: 10px;
            border: none;
            border-right: 1px solid #ccc;
            font-size: 14px;
        }
        .chatbot-footer button {
            padding: 10px 20px;
            border: none;
            background: #4CAF50;
            color: white;
            cursor: pointer;
        }
    </style>
</head>
<body>
<header>
    <h1>헬스 추천 플랫폼</h1>
    <p>당신의 목표에 맞는 운동 루틴과 식단을 추천합니다</p>
</header>

<nav>
    <div class="dropdown">
        <a>부위별 운동</a>
        <div class="dropdown-content">
            <a href="javascript:void(0);" onclick="startRoutine('chest')">가슴 운동</a>
            <a href="javascript:void(0);" onclick="startRoutine('shoulder')">어깨 운동</a>
            <a href="javascript:void(0);" onclick="startRoutine('back')">등 운동</a>
        </div>
    </div>
    <a href="javascript:void(0);" onclick="loadStretching()">스트레칭</a>
    <div class="dropdown">
    </div>
    <a href="javascript:void(0);" onclick="toggleChatbot()">AI 트레이너</a>
    <a href="/workout_log" target="_blank">운동 기록</a>



</nav>

<section class="content">
    <h2 id="routine-title">운동 루틴</h2>
    <p id="routine-desc">원하는 부위를 선택하세요.</p>
    <img id="routine-img" src="" alt="운동 이미지" style="display:none;">
    <div class="nav-buttons" style="display:none;" id="nav-buttons">
        <button onclick="prevRoutine()">이전 ◀</button>
        <button onclick="nextRoutine()">다음 ▶</button>
    </div>
</section>

<section class="goal-select">
    <form action="/bulk_select" method="get">
        <button type="submit">벌크업 프로그램</button>
    </form>
    <form action="/diet_select" method="get">
        <button type="submit">다이어트 프로그램</button>
    </form>
</section>

<footer>
    &copy; 운동 루틴 추천 웹서비스
</footer>

<!-- 챗봇 팝업 -->
<div class="chatbot-popup" id="chatbot-popup">
    <div class="chatbot-header">AI 트레이너</div>
    <div class="chatbot-body" id="chatbot-body">
        <div><strong>AI 트레이너:</strong> 안녕하세요! 무엇을 도와드릴까요?</div>
    </div>
    <div class="chatbot-footer">
        <input type="text" id="chat-input" placeholder="메시지를 입력하세요...">
        <button onclick="sendMessage()">전송</button>
    </div>
</div>
<script>
    const routines = {
        chest: [
            { src: "/helth_gif/benchpress.gif", desc: "벤치프레스 - 4세트 10~12회" },
            { src: "/helth_gif/benchpress_dumbbell.gif", desc: "덤벨 벤치프레스 - 4세트 10~12회" },
            { src: "/helth_gif/chestpress.gif", desc: "체스트 프레스 머신 - 4세트 12~15회" },
            { src: "/helth_gif/dips.gif", desc: "딥스 - 3세트 최대 반복" },
            { src: "/helth_gif/incline_dumbbell.gif", desc: "인클라인 덤벨 프레스 - 4세트 10~12회" },
            { src: "/helth_gif/pushup.gif", desc: "푸쉬업 - 3세트 20회" }
        ],
        shoulder: [
            { src: "/helth_ugaa_gif/lateral_raise.gif", desc: "래터럴 레이즈 - 3세트 15회" },
            { src: "/helth_ugaa_gif/shoulderpress_dumbbell.gif", desc: "숄더 프레스 덤벨 - 3세트 12회" },
            { src: "/helth_ugaa_gif/overheadpress.gif", desc: "오버헤드 프레스 - 4세트 10회" },
            { src: "/helth_ugaa_gif/seated_overheadpress.gif", desc: "시티드 오버헤드 프레스 - 3세트 12회" }
        ],
        back: [
            { src: "/helth_gif/img_helth_deung_gif/barbellrow.gif", desc: "바벨 로우 - 4세트 10회" },
            { src: "/helth_gif/img_helth_deung_gif/latpulldown.gif", desc: "랫풀다운 - 4세트 12회" },
            { src: "/helth_gif/img_helth_deung_gif/onearm_dumbbellrow.gif", desc: "원암 덤벨 로우 - 3세트 15회" },
            { src: "/helth_gif/img_helth_deung_gif/pullup.gif", desc: "풀업 - 3세트 최대 반복" }
        ]
    };

    let currentRoutine = [];
    let currentIndex = 0;

    function startRoutine(type) {
        currentRoutine = routines[type];
        currentIndex = 0;
        showRoutine();
        document.getElementById("nav-buttons").style.display = "inline-block";
        document.getElementById("routine-title").innerText = "운동 루틴";
    }

    function showRoutine() {
        if (currentRoutine.length === 0) {
            document.getElementById("routine-desc").innerText = "내용이 없습니다.";
            document.getElementById("routine-img").style.display = "none";
            return;
        }

        const exercise = currentRoutine[currentIndex];
        document.getElementById("routine-desc").innerText = exercise.desc;
        document.getElementById("routine-img").src = exercise.src;
        document.getElementById("routine-img").style.display = "block";
    }

    function nextRoutine() {
        if (currentRoutine.length === 0) return;
        currentIndex = (currentIndex + 1) % currentRoutine.length;
        showRoutine();
    }

    function prevRoutine() {
        if (currentRoutine.length === 0) return;
        currentIndex = (currentIndex - 1 + currentRoutine.length) % currentRoutine.length;
        showRoutine();
    }

    async function loadStretching() {
        const part = 'waist'; // 허리 스트레칭 예시
        const apiKey = 'your key';

        try {
            const response = await fetch(`https://exercisedb.p.rapidapi.com/exercises/bodyPart/${encodeURIComponent(part)}`, {
                method: 'GET',
                headers: {
                    'X-RapidAPI-Key': apiKey,
                    'X-RapidAPI-Host': 'exercisedb.p.rapidapi.com'
                }
            });

            const data = await response.json();

            currentRoutine = data.slice(0, 5).map(ex => ({
                src: ex.gifUrl,
                desc: `${ex.name} - 스트레칭`
            }));

            currentIndex = 0;
            showRoutine();
            document.getElementById("nav-buttons").style.display = "inline-block";
            document.getElementById("routine-title").innerText = "스트레칭 루틴";
        } catch (err) {
            console.error('API 오류:', err);
            alert('스트레칭 운동을 불러오는 데 실패했습니다.');
        }
    }

    // ⭐️ 수정된 toggleChatbot (스크롤 유지됨)
    function toggleChatbot() {
        const chatbot = document.getElementById("chatbot-popup");
        if (chatbot.style.visibility === "hidden" || chatbot.style.visibility === "") {
            chatbot.style.visibility = "visible";
            chatbot.style.opacity = "1";
        } else {
            chatbot.style.visibility = "hidden";
            chatbot.style.opacity = "0";
        }
    }

    async function sendMessage() {
        const input = document.getElementById("chat-input");
        const body = document.getElementById("chatbot-body");

        const message = input.value.trim();

        if (message !== "") {
            const userMsg = document.createElement("div");
            userMsg.innerHTML = `<strong>나:</strong> ${message}`;
            body.appendChild(userMsg);

            const reply = await getGroqReply(message);

            const botReply = document.createElement("div");
            botReply.innerHTML = `<strong>AI 트레이너:</strong> ${reply}`;
            body.appendChild(botReply);

            input.value = "";
            body.scrollTop = body.scrollHeight;
        }
    }

    async function getGroqReply(userMessage) {
        const apiKey = 'your key';

        const response = await fetch("https://api.groq.com/openai/v1/chat/completions", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": `Bearer ${apiKey}`
            },
            body: JSON.stringify({
                model: "meta-llama/llama-4-scout-17b-16e-instruct",
                messages: [{ role: "user", content: userMessage }]
            })
        });

        const data = await response.json();
        return data.choices[0].message.content.trim();
    }

    // 엔터 키로 전송
    document.getElementById("chat-input").addEventListener("keyup", function(event) {
        if (event.key === "Enter") {
            sendMessage();
        }
    });
</script>

</body>
</html>
